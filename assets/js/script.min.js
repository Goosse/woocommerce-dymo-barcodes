!function($){function e(){t(),r()}function t(){var e=wcb_params.label_size,t=$("#woocommerce_product_barcodes_label_size");t.length&&(e=t.val()),a(e)}function r(){var e=$("#woocommerce_product_barcodes_dymo_printer"),t=dymo.label.framework.getLabelWriterPrinters();if("undefined"==typeof t)return void alert(wcb_params.no_prints_error);for(var r=0;r<t.length;++r){var a=t[r],n=a.name,o=$("<option>").val(n).text(n);e.append(o)}}function a(e){$.get(wcb_params.plugin_url+"/assets/labels/"+e+".label",function(e){d=dymo.label.framework.openLabelXml(e),i(),c()},"text")}function n(e,t){try{if(!d)throw wcb_params.label_loaded_error;if(!p)throw wcb_params.data_loaded_error;d.print(wcb_params.dymo_printer,null,e)}catch(t){alert(t.message||t)}}function o(){var e=new dymo.label.framework.LabelSetBuilder;return $(".wcb_barcodes").each(function(t,r){for(var a=$(this),n=a.find("input.product-name").val(),o=a.find("input.product-barcode").val(),c=a.find("input.product-metadata").val(),i=a.find("input.product-label-input").val(),d=0;i>d;d++){var p=e.addRecord();p.setText("product_name",n),p.setText("metadata",$.trim(c)),p.setText("product_barcode",o)}}),e}function c(){var e=$("#woocommerce-dymo-print-preview-img"),t=d.render();e.attr("src","data:image/png;base64,"+t)}function i(){var e=$(".metadata:checked").map(function(){return $.trim($(this).parent().text())}).get().join(" "),t=$(".name:checked").map(function(){return $.trim($(this).parent().text())}).get().join(" "),r=$(".barcode:checked").map(function(){return $.trim("1234")}).get().join(" ");d.setObjectText("metadata",e),d.setObjectText("product_name",t),d.setObjectText("product_barcode",r)}var d,p,u,l=1;$(window).on("load",e),$(document).on("change","#woocommerce_product_barcodes_label_size",function(){var e=$(this).val();a(e)}),$(document).on("change",".label-preview-option",function(){i(),c()}),$(document).on("change keyup",".product-label-input",function(){var e=0,t=$("#wcb_print_btn");$(".product-label-input").each(function(){e+=Number($(this).val()),wcb_params.dymo_printer&&(e>0?t.prop("disabled",!1).find("span").text(e):t.prop("disabled",!0).find("span").text(""))})}),$(document).on("click","#wcb_print_btn",function(e){return event.preventDefault(),p=o(),n(p,e),!1})}(jQuery);