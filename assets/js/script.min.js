jQuery(function($){function e(){r(),t(),o()}function r(){var e=dymo.label.framework.checkEnvironment();e.isFrameworkInstalled&&e.isBrowserSupported||$("body").hasClass("product_page_product_barcodes")&&$(".wrap").find("h2").after('<div class="error"><p>'+e.errorDetails+" "+wcb_params.i18n_need_help+"</p></div>")}function t(){var e=wcb_params.label_size,r=$("#woocommerce_product_barcodes_label_size");r.length&&(e=r.val()),a(e)}function o(){var e=dymo.label.framework.getLabelWriterPrinters();if("undefined"!=typeof e&&0!==e.length)for(var r=0;r<e.length;++r){var t=e[r];$("<option>").val(t.name).text(t.name).appendTo("#woocommerce_product_barcodes_dymo_printer"),$("#woocommerce_product_barcodes_dymo_printer").find("option").eq(r+1).prop("selected",!0)}}function a(e){$.get(wcb_params.plugin_url+"/assets/labels/"+e+".label",function(e){p=dymo.label.framework.openLabelXml(e),d(),i()},"text")}function n(e){var r=dymo.label.framework.getLabelWriterPrinters(),t=dymo.label.framework.checkEnvironment(),o=$("#woocommerce_product_barcodes_dymo_printer").val();try{if(!t.isFrameworkInstalled||!t.isBrowserSupported)throw t.errorDetails;if(0===r.length)throw wcb_params.i18n_no_printers_error;if(""===o)throw wcb_params.i18n_no_printers_error;if(!p)throw wcb_params.i18n_label_loaded_error;if(!l)throw wcb_params.i18n_data_loaded_error;p.print($("#woocommerce_product_barcodes_dymo_printer").val(),null,e)}catch(a){alert(a.message||a)}}function c(){var e=new dymo.label.framework.LabelSetBuilder;return $(".wcb_barcodes").each(function(r,t){for(var o=$(this),a=o.find("input.product-name").val(),n=o.find("input.product-barcode").val(),c=o.find("input.product-metadata").val(),i=o.find("input.product-label-input").val(),d=0;i>d;d++){var p=e.addRecord();p.setText("product_name",a),p.setText("metadata",$.trim(c)),p.setText("product_barcode",n)}}),e}function i(){p&&$("#woocommerce-dymo-print-preview-img").show().attr("src","data:image/png;base64,"+p.render())}function d(){var e=$(".metadata:checked").map(function(){return $.trim($(this).parent().text())}).get().join(" "),r=$(".name:checked").map(function(){return $.trim($(this).parent().text())}).get().join(" "),t=$(".barcode:checked").map(function(){return $.trim("1234")}).get().join(" ");p.setObjectText("metadata",e),p.setObjectText("product_name",r),p.setObjectText("product_barcode",t)}if("undefined"==typeof wcb_params)return!1;var p,l,m,u=1;$(window).on("load",e),$(document).on("change","#woocommerce_product_barcodes_label_size",function(){var e=$(this).val();a(e)}),$(document).on("change",".label-preview-option",function(){d(),i()}),$(document).on("change keyup",".product-label-input",function(){var e=0,r=$("#wcb_print_btn");$(".product-label-input").each(function(){e+=Number($(this).val()),e>0?r.prop("disabled",!1).find("span").text(e):r.prop("disabled",!0).find("span").text("")})}),$(document).on("click","#wcb_print_btn",function(e){return e.preventDefault(),l=c(),n(l),!1})});