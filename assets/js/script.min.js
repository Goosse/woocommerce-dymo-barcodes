jQuery(function($){function e(){r(),t(),a()}function r(){var e=dymo.label.framework.checkEnvironment();e.isFrameworkInstalled&&e.isBrowserSupported||$("body").hasClass("product_page_product_barcodes")&&$(".wrap").find("h2").after('<div class="error"><p>'+e.errorDetails+" "+wcb_params.i18n_need_help+"</p></div>")}function t(){var e=wcb_params.label_size,r=$("#woocommerce_product_barcodes_label_size");r.length&&(e=r.val()),n(e)}function a(){var e=dymo.label.framework.getLabelWriterPrinters();if("undefined"!=typeof e&&0!==e.length)for(var r=0;r<e.length;++r){var t=e[r];$("<option>").val(t.modelName).text(t.name).appendTo("#woocommerce_product_barcodes_dymo_printer")}}function n(e){$.get(wcb_params.plugin_url+"/assets/labels/"+e+".label",function(e){l=dymo.label.framework.openLabelXml(e),d(),c()},"text")}function o(e){var r=dymo.label.framework.getLabelWriterPrinters(),t=dymo.label.framework.checkEnvironment();try{if(!t.isFrameworkInstalled||!t.isBrowserSupported)throw t.errorDetails;if(0===r.length)throw wcb_params.i18n_no_printers_error;if(!l)throw wcb_params.i18n_label_loaded_error;if(!p)throw wcb_params.i18n_data_loaded_error;l.print(wcb_params.dymo_printer,null,e)}catch(a){alert(a.message||a)}}function i(){var e=new dymo.label.framework.LabelSetBuilder;return $(".wcb_barcodes").each(function(r,t){for(var a=$(this),n=a.find("input.product-name").val(),o=a.find("input.product-barcode").val(),i=a.find("input.product-metadata").val(),c=a.find("input.product-label-input").val(),d=0;c>d;d++){var l=e.addRecord();l.setText("product_name",n),l.setText("metadata",$.trim(i)),l.setText("product_barcode",o)}}),e}function c(){l&&$("#woocommerce-dymo-print-preview-img").show().attr("src","data:image/png;base64,"+l.render())}function d(){var e=$(".metadata:checked").map(function(){return $.trim($(this).parent().text())}).get().join(" "),r=$(".name:checked").map(function(){return $.trim($(this).parent().text())}).get().join(" "),t=$(".barcode:checked").map(function(){return $.trim("1234")}).get().join(" ");l.setObjectText("metadata",e),l.setObjectText("product_name",r),l.setObjectText("product_barcode",t)}if("undefined"==typeof wcb_params)return!1;var l,p,m,u=1;$(window).on("load",e),$(document).on("change","#woocommerce_product_barcodes_label_size",function(){var e=$(this).val();n(e)}),$(document).on("change",".label-preview-option",function(){d(),c()}),$(document).on("change keyup",".product-label-input",function(){var e=0,r=$("#wcb_print_btn");$(".product-label-input").each(function(){e+=Number($(this).val()),wcb_params.dymo_printer&&(e>0?r.prop("disabled",!1).find("span").text(e):r.prop("disabled",!0).find("span").text(""))})}),$(document).on("click","#wcb_print_btn",function(e){return e.preventDefault(),p=i(),o(p),!1})});