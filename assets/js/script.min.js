!function($){function t(){e(),a()}function e(){var t=wcb_params.label_size,e=$("#woocommerce_product_barcodes_label_size");e.length&&(t=e.val()),r(t)}function a(){for(var t=$("#woocommerce_product_barcodes_dymo_printer"),e=dymo.label.framework.getLabelWriterPrinters(),a=0;a<e.length;++a){var r=e[a],n=r.name,o=$("<option>").val(n).text(n);t.append(o)}}function r(t){$.get(wcb_params.plugin_url+"/assets/labels/"+t+".label",function(t){d=dymo.label.framework.openLabelXml(t),i(),c()},"text")}function n(t,e){try{if(!d)throw wcb_params.label_loaded_error;if(!u)throw wcb_params.data_loaded_error;var a=d.printAndPollStatus(wcb_params.dymo_printer,null,t,function(t,e){var a=e.status!=dymo.label.framework.PrintJobStatus.ProcessingError&&e.status!=dymo.label.framework.PrintJobStatus.Finished;return a},1e3)}catch(e){alert(e.message||e)}}function o(){var t=new dymo.label.framework.LabelSetBuilder;return $(".variation").each(function(e,a){for(var r=$(this),n=r.find("input.product-name").val(),o=r.find("input.product-barcode").val(),c=r.find("input.product-metadata").val(),i=r.find("input.product-label-input").val(),d=0;i>d;d++){console.log(n+" : "+c+" : "+o);var u=t.addRecord();u.setText("product_name",n),u.setText("metadata",$.trim(c)),u.setText("product_barcode",o)}}),t}function c(){var t=$("#woocommerce-dymo-print-preview-img"),e=d.render();t.attr("src","data:image/png;base64,"+e)}function i(){var t=$(".metadata:checked").map(function(){return $.trim($(this).parent().text())}).get().join(" "),e=$(".name:checked").map(function(){return $.trim($(this).parent().text())}).get().join(" "),a=$(".barcode:checked").map(function(){return $.trim("1234")}).get().join(" ");d.setObjectText("metadata",t),d.setObjectText("product_name",e),d.setObjectText("product_barcode",a)}var d,u,l,p=1;$(window).on("load",t),$(document).on("change","#woocommerce_product_barcodes_label_size",function(){var t=$(this).val();r(t)}),$(document).on("change",".label-preview-option",function(){i(),c()}),$(document).on("change keyup",".product-label-input",function(){var t=0,e=$("#wcb_print_btn");$(".product-label-input").each(function(){t+=Number($(this).val()),wcb_params.dymo_printer&&(t>0?e.prop("disabled",!1).find("span").text(t):e.prop("disabled",!0).find("span").text(""))})}),$(document).on("click","#wcb_print_btn",function(t){return t.preventDefault(),u=o(),n(u,t),!1})}(jQuery);